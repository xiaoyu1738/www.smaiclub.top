<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>会员服务支付</title>
    <meta name="description" content="会员服务支付与结果页面">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- 通用及 index.html 样式 --- */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --text-color: #2c3e50;
            --light-text: #7f8c8d;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #e4eff9 100%);
            --card-gradient: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: var(--bg-gradient);
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        /* --- 支付表单容器 --- */
        .container {
            display: flex;
            max-width: 1000px;
            width: 100%;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.5s ease;
        }
        
        /* 会员信息区 */
        .membership-section {
            flex: 1;
            background: linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%);
            color: white;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .benefits {
            margin-top: 30px;
        }
        
        .benefits ul {
            list-style: none;
            margin-top: 20px;
            padding-left: 0;
        }
        
        .benefits li {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .benefits i {
            margin-right: 10px;
            font-size: 18px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        /* 支付表单区 */
        .payment-section {
            flex: 1.2;
            background: white;
            padding: 40px;
        }
        
        .payment-header {
            margin-bottom: 30px;
        }
        
        .payment-header h1 {
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .payment-header p {
            color: #7f8c8d;
            font-size: 16px;
        }
        
        .price-tag {
            font-size: 32px;
            font-weight: 700;
            color: white;
            margin-bottom: 20px;
        }
        
        /* --- START: 新增套餐选择器样式 --- */
        .plan-selector {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
        }
        .plan-option {
            flex: 1;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fff;
        }
        .plan-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        .plan-option.selected {
            border-color: var(--accent-color);
            background-color: #fbeee c;
        }
        .plan-option h4 {
            font-size: 16px;
            margin-bottom: 5px;
            color: var(--secondary-color);
        }
        .plan-option p {
            font-size: 14px;
            color: var(--accent-color);
            font-weight: bold;
        }
        /* --- END: 新增套餐选择器样式 --- */

        .payment-options {
            display: flex;
            gap: 12px;
            margin: 20px 0;
        }
        
        .payment-option {
            flex: 1;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fff;
        }
        
        .payment-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .payment-option.selected {
            border-color: #3498db;
            background-color: #e1f0fa;
        }
        
        .payment-option i {
            font-size: 28px;
            margin-bottom: 10px;
            color: #3498db;
        }
        
        .payment-option.wechat i { color: #09bb07; }
        .payment-option.alipay i { color: #1777ff; }
        .payment-option.selected i { color: #2c3e50; }
        
        .form-group {
            margin-bottom: 22px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 15px;
        }
        
        .input-container { position: relative; }
        
        input {
            width: 100%;
            padding: 14px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 13px;
            height: 18px;
            margin-top: 5px;
            visibility: hidden;
        }
        
        .error-icon {
            position: absolute;
            right: 12px;
            top: 14px;
            color: #e74c3c;
            display: none;
        }
        
        input.error { border-color: #e74c3c; }
        
        .card-group {
            display: flex;
            gap: 15px;
        }
        
        .card-group .form-group { flex: 1; }
        
        .security-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 25px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 14px;
            color: #2c3e50;
        }
        
        .security-badge i {
            color: #27ae60;
            font-size: 20px;
        }
        
        .submit-btn {
            background: linear-gradient(to right, #3498db, #2c3e50);
            color: white;
            border: none;
            padding: 18px;
            width: 100%;
            border-radius: 8px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
        }
        
        .payment-footer {
            text-align: center;
            margin-top: 25px;
            font-size: 13px;
            color: #95a5a6;
        }
        
        .payment-footer a {
            color: #3498db;
            text-decoration: none;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
            color: white;
            font-size: 18px;
        }

        .loading-spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1.5s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- pay_finish.html 的样式 --- */
        .success-container {
            max-width: 800px;
            width: 100%;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12);
            overflow: hidden;
            margin-top: 40px;
            position: relative;
            padding: 50px 40px;
            text-align: center;
        }
        
        .success-header { margin-bottom: 30px; }
        .success-icon {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            animation: pulse 1.5s infinite;
            transition: transform 0.3s ease;
        }
        .success-icon i { font-size: 60px; }
        .success-title { font-size: 36px; font-weight: 700; color: var(--text-color); margin-bottom: 10px; }
        .success-subtitle { font-size: 18px; color: var(--light-text); margin-bottom: 40px; }
        .success-card { background: var(--card-gradient); border-radius: 12px; padding: 30px; margin: 30px auto; max-width: 600px; text-align: left; }
        .membership-info { display: flex; flex-wrap: wrap; justify-content: space-between; padding: 20px 0; gap: 15px; }
        .info-item { flex: 1; min-width: 250px; padding: 15px; }
        .info-item h3 { font-size: 16px; color: var(--light-text); margin-bottom: 5px; font-weight: 600; }
        .info-item p { font-size: 22px; font-weight: 700; color: var(--primary-color); }
        .info-item .membership-type { color: var(--accent-color); }
        .divider { height: 1px; background: linear-gradient(90deg, rgba(52, 152, 219, 0) 0%, rgba(52, 152, 219, 0.4) 50%, rgba(52, 152, 219, 0) 100%); margin: 15px 0; }
        .benefits-section { background: white; border-radius: 12px; padding: 35px 40px; margin: 40px auto 30px; max-width: 700px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05); }
        .section-title { font-size: 24px; font-weight: 700; color: var(--text-color); text-align: center; margin-bottom: 30px; position: relative; }
        .section-title::after { content: ''; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); width: 50px; height: 3px; background: var(--primary-color); border-radius: 3px; }
        .benefits-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-top: 30px; }
        .benefit-card { padding: 25px 20px; background: #f8f9fa; border-radius: 10px; transition: transform 0.3s ease, box-shadow 0.3s ease; text-align: center; opacity: 0; animation: fadeIn 0.5s forwards; }
        .benefit-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08); }
        .benefit-card i { font-size: 42px; color: var(--primary-color); margin-bottom: 15px; }
        .benefit-card h3 { font-size: 18px; margin-bottom: 12px; color: var(--text-color); }
        .benefit-card p { font-size: 15px; color: var(--light-text); }
        .action-buttons { display: flex; justify-content: center; gap: 20px; margin: 40px 0 30px; flex-wrap: wrap; }
        .btn { padding: 16px 32px; border-radius: 50px; font-size: 17px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; justify-content: center; min-width: 220px; border: none; }
        .btn-primary { background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); color: white; box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4); }
        .btn-primary:hover, .btn-primary:focus { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(52, 152, 219, 0.6); }
        .btn-secondary { background: white; color: var(--primary-color); border: 2px solid var(--primary-color) !important; }
        .btn-secondary:hover, .btn-secondary:focus { background: #f0f7ff; transform: translateY(-3px); }
        .btn i { margin-right: 8px; }
        .thank-you-note { margin: 30px auto 40px; max-width: 600px; font-size: 18px; line-height: 1.8; color: var(--text-color); position: relative; padding: 0 20px; }
        
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(58, 123, 213, 0.5); } 70% { box-shadow: 0 0 0 20px rgba(58, 123, 213, 0); } 100% { box-shadow: 0 0 0 0 rgba(58, 123, 213, 0); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        @media (max-width: 768px) {
            .container { flex-direction: column; }
            .membership-section { padding: 30px; }
            .plan-selector, .payment-options, .card-group { flex-direction: column; gap: 10px; }
            .card-group { gap: 0; }
            .success-container { padding: 30px 20px; margin-top: 20px; }
            .success-title { font-size: 28px; } .success-subtitle { font-size: 16px; }
            .info-item { min-width: 100%; padding: 10px 5px; }
            .action-buttons { flex-direction: column; gap: 15px; } .btn { width: 100%; }
            .benefits-section { padding: 25px 20px; }
        }
        @media (max-width: 480px) {
            .success-title { font-size: 24px; } .success-icon { width: 90px; height: 90px; } .success-icon i { font-size: 45px; }
            .thank-you-note { font-size: 16px; padding: 0 10px; }
        }
    </style>
</head>
<body>
    <!-- 初始显示的支付表单 -->
    <div class="container">
        <!-- 会员信息区 -->
        <div class="membership-section">
            <div>
                <h1 id="plan-title"></h1>
                <p>加入我们，享受专属服务与特权</p>
                <div class="benefits">
                    <h3 id="plan-benefits-title"></h3>
                    <ul id="plan-benefits-list"></ul>
                </div>
            </div>
            <div class="price-tag" id="plan-price"></div>
        </div>
        
        <!-- 支付表单区 -->
        <div class="payment-section">
            <div class="payment-header">
                <h1>会员支付</h1>
                <p>请填写您的支付信息</p>
            </div>
            <form id="paymentForm">
                <!-- 套餐选择器 -->
                <div class="form-group">
                    <label>选择套餐</label>
                    <div class="plan-selector">
                        <div class="plan-option selected" data-plan-id="svip1">
                            <h4>SMAICLUB SVIP I</h4>
                            <p>10000元/年</p>
                        </div>
                        <div class="plan-option" data-plan-id="vip">
                            <h4>SMAICLUB VIP</h4>
                            <p>5000元/年</p>
                        </div>
                        <div class="plan-option" data-plan-id="svip2">
                            <h4>SMAI SVIP II</h4>
                            <p>1145元/年</p>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="name">姓名</label>
                    <div class="input-container"><input type="text" id="name" name="name" placeholder="请输入您的真实姓名"><span class="error-icon">✘</span></div>
                    <div class="error-message" id="nameError">请输入2-4个汉字作为姓名</div>
                </div>
                <div class="card-group">
                    <div class="form-group">
                        <label for="phone">手机号</label>
                        <div class="input-container"><input type="text" id="phone" name="phone" placeholder="请输入手机号"><span class="error-icon">✘</span></div>
                        <div class="error-message" id="phoneError">请输入11位有效手机号</div>
                    </div>
                    <div class="form-group">
                        <label for="email">邮箱 (可选)</label>
                        <div class="input-container"><input type="text" id="email" name="email" placeholder="请输入电子邮箱"><span class="error-icon">✘</span></div>
                        <div class="error-message" id="emailError">请输入有效邮箱地址</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>支付方式</label>
                    <div class="payment-options">
                        <div class="payment-option selected" data-type="card"><i class="far fa-credit-card"></i><div>银行卡</div></div>
                        <div class="payment-option" data-type="alipay"><i class="fab fa-alipay"></i><div>支付宝</div></div>
                        <div class="payment-option" data-type="wechat"><i class="fab fa-weixin"></i><div>微信支付</div></div>
                    </div>
                </div>
                <div id="bankCardFields">
                    <div class="form-group">
                        <label for="cardNumber">银行卡号</label>
                        <div class="input-container"><input type="text" id="cardNumber" name="cardNumber" placeholder="请输入16或19位银行卡号"><span class="error-icon">✘</span></div>
                        <div class="error-message" id="cardError">请输入有效的银行卡号</div>
                    </div>
                </div>
                <div id="thirdPartyMsg" style="display: none;">
                    <div class="security-badge"><i class="fas fa-info-circle"></i><div>选择支付宝/微信支付后，点击支付按钮将跳转到相应支付平台完成支付</div></div>
                </div>
                <div class="security-badge"><i class="fas fa-lock"></i><div>您的支付信息加密保护，安全可靠</div></div>
                <button type="submit" class="submit-btn">立即支付</button>
            </form>
            <div class="payment-footer">点击支付即表示您同意<a href="#">会员协议</a>和<a href="#">隐私政策</a></div>
        </div>
    </div>

    <!-- 支付成功后显示的内容 (初始隐藏) -->
    <div class="success-container" style="display: none;">
        <div class="success-header">
            <div class="success-icon" aria-hidden="true"><i class="fas fa-check-circle" aria-hidden="true"></i></div>
            <h1 class="success-title">支付成功！</h1>
            <p class="success-subtitle">三克油喂你妈吃！</p>
        </div>
        <div class="success-card">
            <h2 class="section-title">会员信息</h2>
            <div class="membership-info">
                <div class="info-item">
                    <h3>会员类型</h3>
                    <p class="membership-type" id="success-plan-type"></p>
                </div>
                <div class="info-item">
                    <h3>支付金额</h3>
                    <p id="success-plan-price"></p>
                </div>
                <div class="info-item">
                    <h3>订单号</h3>
                    <p>CNM_114514_666</p>
                </div>
                <div class="info-item">
                    <h3>有效期</h3>
                    <p>2025年7月8日 - 2026年12月32日</p>
                </div>
            </div>
            <div class="divider"></div>
            <div class="security-badge"><i class="fas fa-lock" aria-hidden="true"></i><div>交易安全，由斯麦支付全程保障</div></div>
        </div>
        <div class="thank-you-note">感谢您选择加入我们的会员！您的支持是我们前进的最大动力，我们将竭诚为您提供最优质的会员服务和权益。</div>
        <div class="benefits-section">
            <h2 class="section-title">尊享会员特权</h2>
            <div class="benefits-grid">
                <div class="benefit-card" style="animation-delay: 0.1s"><i class="fas fa-percentage" aria-hidden="true"></i><h3>专享折扣优惠</h3><p>所有商品均可享受会员专享折扣，最高可达7折</p></div>
                <div class="benefit-card" style="animation-delay: 0.2s"><i class="fas fa-truck" aria-hidden="true"></i><h3>免费极速配送</h3><p>订单满99元即可享受全国包邮服务，24小时发货</p></div>
                <div class="benefit-card" style="animation-delay: 0.3s"><i class="fas fa-headset" aria-hidden="true"></i><h3>VIP专属客服</h3><p>尊享24小时一对一服务，优先处理您的需求</p></div>
                <div class="benefit-card" style="animation-delay: 0.4s"><i class="fas fa-gift" aria-hidden="true"></i><h3>会员生日礼遇</h3><p>在您生日当月可领取神秘专属礼包</p></div>
            </div>
        </div>
        <div class="action-buttons">
            <button type="button" class="btn btn-primary"><i class="fas fa-rocket" aria-hidden="true"></i>立即体验会员特权</button>
            <button type="button" class="btn btn-secondary"><i class="fas fa-home" aria-hidden="true"></i>返回首页</button>
        </div>
        <div class="security-badge"><i class="fas fa-shield-alt" aria-hidden="true"></i><div>您的会员信息已通过114位加密保护，安全无忧</div></div>
    </div>

    <!-- 加载提示框 -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>正在支付，请稍候...</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- 数据定义 ---
            const plans = {
                svip1: {
                    name: 'SMAICLUB SVIP I',
                    priceText: '10000元/年',
                    priceValue: '¥ 10000.00',
                    benefitsTitle: 'SVIP I 专属福利:',
                    benefits: [
                        '包含VIP所有服务',
                        '全球机场贵宾厅服务',
                        '一对一专属投资顾问',
                        '私人订制旅行规划',
                        '每月精选奢侈品礼盒'
                    ]
                },
                vip: {
                    name: 'SMAICLUB VIP',
                    priceText: '5000元/年',
                    priceValue: '¥ 5000.00',
                    benefitsTitle: 'VIP 专属福利:',
                    benefits: [
                        '包含SVIP II所有服务',
                        '线下活动优先参与权',
                        '商品购买享额外9折',
                        '专属客服通道',
                        '生日专属大礼包'
                    ]
                },
                svip2: {
                    name: 'SMAI SVIP II',
                    priceText: '1145元/年',
                    priceValue: '¥ 1145.00',
                    benefitsTitle: '会员专属福利:',
                    benefits: [
                        '飞机坠机服务',
                        '高质答辩试吃',
                        '优先趋势服务',
                        '同城月跑优惠',
                        '管家全面保护'
                    ]
                }
            };

            // --- 元素获取 ---
            const paymentFormContainer = document.querySelector('.container');
            const successContainer = document.querySelector('.success-container');
            const loadingOverlay = document.getElementById('loadingOverlay');
            
            // 动态内容元素
            const planTitle = document.getElementById('plan-title');
            const planBenefitsTitle = document.getElementById('plan-benefits-title');
            const planBenefitsList = document.getElementById('plan-benefits-list');
            const planPrice = document.getElementById('plan-price');
            const successPlanType = document.getElementById('success-plan-type');
            const successPlanPrice = document.getElementById('success-plan-price');

            // 表单元素
            const nameInput = document.getElementById('name');
            const cardInput = document.getElementById('cardNumber');
            const phoneInput = document.getElementById('phone');
            const emailInput = document.getElementById('email');
            
            const planOptions = document.querySelectorAll('.plan-option');
            const paymentOptions = document.querySelectorAll('.payment-option');
            const bankCardFields = document.getElementById('bankCardFields');
            const thirdPartyMsg = document.getElementById('thirdPartyMsg');
            
            const validators = {
                name: /^[\u4e00-\u9fa5]{2,4}$/,
                card: /^(?:\d{16}|\d{19})$/,
                phone: /^1[3-9]\d{9}$/,
                email: /^[^\s@]+@[^\s@]+\.[^\s@]+$/
            };

            // --- 功能函数 ---

            /**
             * 根据选择的套餐ID更新页面显示内容
             * @param {string} planId - 套餐ID (svip1, vip, svip2)
             */
            function updatePlanDetails(planId) {
                const selectedPlan = plans[planId];
                if (!selectedPlan) return;

                // 更新左侧会员信息
                planTitle.textContent = selectedPlan.name;
                planPrice.textContent = selectedPlan.priceText;
                planBenefitsTitle.textContent = selectedPlan.benefitsTitle;
                
                planBenefitsList.innerHTML = selectedPlan.benefits
                    .map(benefit => `<li><i class="fas fa-play"></i>${benefit}</li>`)
                    .join('');
                
                // 更新隐藏的成功页面信息
                successPlanType.textContent = selectedPlan.name;
                successPlanPrice.textContent = selectedPlan.priceValue;
            }
            
            // --- 事件绑定 ---
            
            // 套餐选择器事件
            planOptions.forEach(option => {
                option.addEventListener('click', () => {
                    planOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    const planId = option.getAttribute('data-plan-id');
                    updatePlanDetails(planId);
                });
            });

            // 支付方式选择事件
            paymentOptions.forEach(option => {
                option.addEventListener('click', () => {
                    paymentOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    const paymentType = option.getAttribute('data-type');
                    bankCardFields.style.display = (paymentType === 'card') ? 'block' : 'none';
                    thirdPartyMsg.style.display = (paymentType !== 'card') ? 'block' : 'none';
                });
            });
            
            // 实时输入验证
            nameInput.addEventListener('input', () => validateField(nameInput, validators.name, 'nameError', '请输入2-4个汉字作为姓名'));
            phoneInput.addEventListener('input', () => validateField(phoneInput, validators.phone, 'phoneError', '请输入有效的11位手机号'));
            emailInput.addEventListener('input', () => validateEmail(emailInput));
            cardInput.addEventListener('input', () => {
                validateField(cardInput, validators.card, 'cardError', '请输入16或19位有效银行卡号');
                formatCardNumber(cardInput);
            });
            
            // 表单提交处理
            document.getElementById('paymentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                let isValid = true;
                isValid = validateField(nameInput, validators.name, 'nameError', '请输入2-4个汉字作为姓名') && isValid;
                isValid = validateField(phoneInput, validators.phone, 'phoneError', '请输入有效的11位手机号') && isValid;
                
                if (emailInput.value && !validators.email.test(emailInput.value)) {
                    setError(emailInput, 'emailError', '请输入有效邮箱地址');
                    isValid = false;
                } else { clearError(emailInput, 'emailError'); }
                
                if (document.querySelector('.payment-option.selected').getAttribute('data-type') === 'card') {
                    isValid = validateField(cardInput, validators.card, 'cardError', '请输入16或19位有效银行卡号') && isValid;
                }
                
                if (isValid) {
                    loadingOverlay.style.display = 'flex';
                    setTimeout(() => {
                        loadingOverlay.style.display = 'none';
                        paymentFormContainer.style.display = 'none';
                        successContainer.style.display = 'block';
                        runSuccessAnimations();
                    }, 2000);
                }
            });

            // --- 辅助函数 ---
            function runSuccessAnimations() {
                const successIcon = document.querySelector('.success-icon');
                if (successIcon) {
                    setTimeout(() => {
                        successIcon.style.transform = 'scale(1.1)';
                        setTimeout(() => { successIcon.style.transform = 'scale(1)'; }, 300);
                    }, 500);
                }
            }
            
            function validateField(input, regex, errorId, errorMsg) {
                const value = input.id === 'cardNumber' ? input.value.replace(/\s+/g, '') : input.value;
                if (!value.trim()) { clearError(input, errorId); return false; }
                if (regex.test(value)) { clearError(input, errorId); return true; } 
                else { setError(input, errorId, errorMsg); return false; }
            }
            
            function validateEmail(input) {
                if (!input.value.trim()) { clearError(input, 'emailError'); return; }
                if (validators.email.test(input.value)) { clearError(input, 'emailError'); }
                else { setError(input, 'emailError', '请输入有效邮箱地址'); }
            }
            
            function setError(input, errorId, errorMsg) {
                const errorEl = document.getElementById(errorId);
                const icon = input.parentElement.querySelector('.error-icon');
                input.classList.add('error');
                errorEl.textContent = errorMsg;
                errorEl.style.visibility = 'visible';
                if(icon) icon.style.display = 'block';
            }
            
            function clearError(input, errorId) {
                const errorEl = document.getElementById(errorId);
                const icon = input.parentElement.querySelector('.error-icon');
                input.classList.remove('error');
                if (errorEl) errorEl.style.visibility = 'hidden';
                if (icon) icon.style.display = 'none';
            }
            
            function formatCardNumber(input) {
                let value = input.value.replace(/\s+/g, '').replace(/\D/g, '');
                input.value = (value.match(/.{1,4}/g) || []).join(' ');
            }

            // --- 页面初始化 ---
            function initializePage() {
                const defaultPlanId = document.querySelector('.plan-option.selected').getAttribute('data-plan-id');
                updatePlanDetails(defaultPlanId);
            }

            initializePage();
        });
    </script>
</body>
</html>```